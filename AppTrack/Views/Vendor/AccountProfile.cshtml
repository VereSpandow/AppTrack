@if (ViewBag.ErrorCode == Constants.fatalErrorCode)
{
    <div id="contactContainerDiv">
        <div class="col-sm-12" style="font-size: 1.5em">
            <br />
            <br />
            The following unexpected error was encountered:
            <br />
            <br />
            <span class=" text-danger">@ViewBag.ErrorMessage</span>
            <br />
            <br />
            Please contact technical support.
        </div>
    </div>
}
else
{
    @model AppTrack.ViewModels.VendorProfileViewModel

    <div class="pull-left" style="width:70%"><h2>@Model.VendorRecord.DisplayName</h2></div>

    <div class="pull-right" style="width:30%; text-align:right;">
        @if (ViewBag.Disabled == "")
        {
            if (Model.VendorRecord.Status.ToUpper() != "INACTIVE" && Model.VendorRecord.Status.ToUpper() != "DELETED")
            {
                <span onclick="deleteVendor()" class="btn btn-xs btn-danger">
                    Set InActive
                </span>
            }

            if (Model.VendorRecord.Status.ToUpper() == "INACTIVE")
            {
                <span onclick="undeleteVendor()" class="btn btn-xs btn-success">
                    Set Active
                </span>
            }
        }

    </div>

    <div class="col-md-12">
        <ul id="tabstrip" class="nav nav-tabs" role="tablist">
            <li class="active"><a href="#Profile" role="tab" data-toggle="tab">Profile</a></li>
            <li><a href="#Company" role="tab" data-toggle="tab">Company</a></li>
            <li><a class="ajax" href="#ContactList" role="tab" data-toggle="tab">Contacts</a></li>
            <li><a class="ajax" href="#ProgramList" role="tab" data-toggle="tab">Programs</a></li>
            <li><a class="ajax" href="#RequirementList" role="tab" data-toggle="tab">Requirements</a></li>
            <li><a href="#Documents" role="tab" data-toggle="tab">Documents</a></li>
            <li><a class="ajax" href="#RebateList" role="tab" data-toggle="tab">Rebates</a></li>
            <li><a class="CustomerNotesLink" href="#CustomerNotesTab" role="tab" data-toggle="tab">Notes</a></li>
        </ul>

        <!-- Tab Content Containers -->
        <div class="tab-content" style="padding-top:15px;">
            <div class="tab-pane fade in active" id="Profile">
                <div class="col-md-6 col-sm-12 pull-left">
                    <div class="panel panel-default" style="min-height:200px;">
                        <div class=" panel-heading">Company Information</div>
                        <div class="panel-body">
                            @Model.VendorRecord.Company
                            <br />
                            @if (Model.VendorRecord.Address1 != "")
                            {
                                @Model.VendorRecord.Address1
                                if (!String.IsNullOrEmpty(Model.VendorRecord.Address2))
                                {
                                    <span>,</span> @Model.VendorRecord.Address2
                                }
                                <br />
                                @Model.VendorRecord.City<span>,</span> @Model.VendorRecord.State <span>&nbsp;</span>@Model.VendorRecord.PostalCode
                                <br />
                            }
                            @Helpers.FormatPhone(@Model.VendorRecord.CompanyPhone)
                            <br />
                            @Model.VendorRecord.Email
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-sm-12 pull-left">
                    <div class="panel panel-default" style="min-height:200px;">
                        <div class=" panel-heading">Programs</div>
                        <div class="panel-body">
                            <table class="table table-hover table-striped table-responsive" id="documentsTable" style="font-size:.8em">
                                <thead>
                                    <tr>
                                        <th>
                                            Membership
                                        </th>
                                        <th>
                                            Program Name
                                        </th>
                                        <th>
                                            Start Date
                                        </th>
                                        <th>
                                            Status
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.VendorProgramList)
                                    {
                                        <tr>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.C_ProgramName)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.ProgramName)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.StartDate)
                                            </td>
                                            <td>
                                                <span class="status-@item.Status.ToUpper()">@Html.DisplayFor(modelItem => item.Status)</span>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 col-sm-12 pull-left">
                    <div class="panel panel-default" style="min-height:250px;">
                        <div class=" panel-heading">Contacts</div>
                        <div class="panel-body">
                            <table class="table table-hover table-striped table-responsive" id="documentsTable" style="font-size:.8em">
                                <thead>
                                    <tr>
                                        <th>
                                            Type
                                        </th>
                                        <th>
                                            Name
                                        </th>
                                        <th>
                                            Email
                                        </th>
                                        <th>
                                            Phone
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.VendorContactList)
                                    {
                                        <tr>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.ContactType)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.DisplayName)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.Email)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.DayPhone)
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 col-sm-12 pull-left">
                    <div class="panel panel-default" style="min-height:250px;">
                        <div class=" panel-heading">Requirements</div>
                        <div class="panel-body">
                            <table class="table table-hover table-striped table-responsive" id="documentsTable" style="font-size:.8em">
                                <thead>
                                    <tr>
                                        <th>
                                            Type
                                        </th>
                                        <th>
                                            Name
                                        </th>
                                        <th>
                                            Status
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.VendorRequirementList)
                                    {
                                        <tr>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.RequirementType)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.RequirementName)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.Status)
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
            <div class="tab-pane fade" id="Company"><iframe src="@Url.Action("Company", "Vendor", new { VendorID = @ViewBag.VendorID, PageLayout = "I" }, @Constants.secureProtocol )" frameborder="0" style="width:100%;height:1000px;"></iframe></div>
            <div class="tab-pane fade" id="ContactList"></div>
            <div class="tab-pane fade" id="ProgramList"></div>
            <div class="tab-pane fade" id="RequirementList"></div>
            <div class="tab-pane fade" id="Documents" style="width:100%;height:auto;"><iframe src="@Url.Action("Documents", "Vendor", new { VendorID = @ViewBag.VendorID, PageLayout = "I" }, @Constants.secureProtocol)" frameborder=" 0" style="width:100%;height:1000px;"></iframe></div>
            <div class="tab-pane fade" id="RebateList"></div>
            <div class="tab-pane fade" id="CustomerNotesTab">@*{Html.RenderAction("NotesList", "CustomerNotes", new { ID = @ViewBag.VendorID });}*@</div>
        </div>
    </div>

        <!-- DELETE VENDOR FORM -->
    using (Html.BeginForm("UpdateVendorStatus", "Vendor", FormMethod.Post, new { id = "updateVendorForm" }))
    {
        @Html.AntiForgeryToken()
        <input type="hidden" name="CustID" id="updateVendorID" value="@Model.VendorRecord.CustID" />
        <input type="hidden" name="StatusID" id="updateStatusID" value="" />
    }

    <div class="modal fade" id="deleteVendorModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Confirmation</h4>
                </div>
                <div class="modal-body">
                    <h4>
                        Are you sure you want to make this Vendor InActive?
                    </h4>
                    <br />
                    <p>
                        Vendors can be reset to Active at any time.
                    </p>
                </div>
                <div class="modal-footer">

                    <div class="btn btn-info pull-left" data-dismiss="modal">No, Keep Vendor Active</div>
                    <div class="btn btn-danger pull-right" onclick="deleteVendorConfirm()">Yes, Make Vendor InActive</div>
                </div><!-- /.modal-footer-->
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div class="modal fade" id="undeleteVendorModal" tabindex="-1" role="dialog" aria-labelledby="undeleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Confirmation</h4>
                </div>
                <div class="modal-body">
                    <h4>
                        Are you sure you want to make this Vendor Active?
                    </h4>
                    <br />
                    <p>
                        Vendors can be set to InActive at any time.
                    </p>
                </div>
                <div class="modal-footer">

                    <div class="btn btn-info pull-left" data-dismiss="modal">No, Keep Vendor InActive</div>
                    <div class="btn btn-success pull-right" onclick="undeleteVendorConfirm()">Yes, Make Vendor Active</div>
                </div><!-- /.modal-footer-->
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->


    <script>
        function deleteVendor() {
            $("#updateStatusID").val('3');
            $('#deleteVendorModal').modal('show');
        };

        function deleteVendorConfirm() {
            $('#deleteVendorModal').modal('hide');
            $("#updateVendorForm").submit();
        };

        function undeleteVendor() {
            $("#updateStatusID").val('1');
            $('#undeleteVendorModal').modal('show');
        };

        function undeleteVendorConfirm() {
            $('#undeleteVendorModal').modal('hide');
            $("#updateVendorForm").submit();
        };

        $('#tabstrip .ajax').click(function (e) {
            var tabID = $(this).attr("href").substr(1);
            if ($("#" + tabID).html() == "") {
                e.preventDefault()
                $(this).tab('show')
                $("#" + tabID).html("<div style='text-align:center;padding-top:50px;'><img src='/Content/Images/ajaxLoader.gif' /></div>");
                $.ajax({
                    url: "/@ViewContext.RouteData.Values["controller"]/" + tabID + "?VendorID=@ViewBag.VendorID",
                    cache: false,
                    type: "get",
                    dataType: "html",
                    success: function (result) {
                        $("#" + tabID).html(result);
                    },
                    failure: function () {
                        alert("Ooops - something went wrong");
                    }
                });
            }
        });

        $('#tabstrip .CustomerNotesLink').click(function (e) {
            var tabID = $(this).attr("href").substr(1);
            if ($("#" + tabID).html() == "") {
                e.preventDefault()
                $(this).tab('show')
                $("#" + tabID).html("<div style='text-align:center;padding-top:50px;'><img src='/Content/Images/ajaxLoader.gif' /></div>");
                $.ajax({
                    url: "/CustomerNotes/NotesList/@ViewBag.VendorID",
                    cache: false,
                    type: "get",
                    dataType: "html",
                    success: function (result) {
                        $("#" + tabID).html(result);
                        $.validator.unobtrusive.parse(document);
                        $("#SearchStartDate").datepicker();
                        $("#SearchEndDate").datepicker();
                    },
                    failure: function () {
                        alert("Ooops - something went wrong");
                    }
                });
            }
        });

    </script>
}
